Table of Contents
===============

- [Typical Usage](#typical-usage)
- [dataprocessor](#dataprocessor)
- [server.py (for webapp](#serverpy-for-webapp)
- [register_figure](#register_figure)


Typical Usage
================
Move to this sample directory.

    $ ../bin/dataprocessor ./manip1.json
    $ ../bin/server.py install
    $ ../bin/server.py start data_information.json

Open [http://localhost:8080/index.html](http://localhost:8080/index.html) with your favorite browser.
You can see following run directories and some additional information in its page.


The detail description of each command is written in following section.


Including directory and files
--------------

- README: This file
- manip1.json: sample json file for dataprocessor
- datadir: sample dirctory for dataprocessor
  - datadir/project1/run01/parameters.conf: run parameter file
  - datadir/project1/run03/parameters.conf: run parameter file
  - datadir/project2/run01/parameters.ini: run parameter file
  - datadir/project2/run02/parameters.ini: run parameter file
  - datadir/project2/run03/parameters.conf: run parameter file


dataprocessor
============

Usage
-----
Move to this sample directory.

The procedure described in manip1.json adds run directories to
a list of **node** searching configure files,
add collected parameter information of run directories to the list,
and save them to "data\_information.json".

    $ ../bin/dataprocessor ./manip1.json

Read data\_information.json and add parameter configuration information again,
and save to newdata.json.

    $ ../bin/dataprocessor ./manip2.json

Read data\_information.json, add a comment to **node**
specified by "/path/to/node" and save to newdata.json.
For example, change "/path/to/node" to "${PWD}/datadir/project1/run01"
in manip3.json to add a comment to run01 of project1.

    $ ../bin/dataprocessor ./manip3.json

In detail, how to write `manipulation.json` and pipe's list are written in [here](../doc/pipes.md).


dpmanip
=======

The command `dpmanip` execute a pipe with loaded node_list.
In order to execute `add_comment` pipe, execute the following command:

    $ ../bin/dpmanip data_information.json add_comment "comment" /path/of/run

You can see all pipes by `-h` or `--help` option:

    $ ../bin/dpmanip -h

You also can see help of each pipes:

    $ ../bin/dpmanip data_information.json add_comment -h

server.py (for webapp)
==========

You have to install `python-daemon` first:
    # easy_install python-daemon

If you install it by package managers (s.t. apt, yum),
you should check the version of `python-daemon`.
This project requires `1.6` or newer.

See also help generated by the following commands:

    $ ../bin/server.py -h
    $ ../bin/server.py start -h

*CAUTION*
The server listen a port.
It may cause a security problem.
Usually, firewalls prevent to access the server from other computers.
If you want to use server from another computer,
you can use SSH port forwarding.

Install
-------

In order to use webapp, a JavaScript library `jQuery` is necessary.
It can be download by the following script:

    $ ../bin/server.py install

Then the library code is downloaded into `../server/js/`.

Start server
------------

Since the main objective of the webapp is browsing and managing data,
the server should know where your data is saved.
This webapp and server suppose that the data is saved into a JSON file.
In order to save data into a JSON file,
see `manip1.json` and other samples described above.
If you use `data_information.json` generated by `manip1.json`,

    $ ../bin/server.py start ./data_information.json --port 8080

Then the server starts on `localhost:8080`.
You can access to [http://localhost:8080/index.html](http://localhost:8080/index.html) by your web-browser.

See also the help

    $ ../bin/server.py start help

stop server
-----------

The following command stops the server.
   $ ../bin/server.py stop


register_figure
=================

identifier of figure
--------------------
In DataProcessor, figures are managed as nodes in `node_list`.
The executable script `register_figure` registers your figure.
Then the figure is copied into `figure_directory`;
if `fig1.png` is registered, it will be copied into
`figure_directory/<hash hexdigits>/fig1.png`.
`<hash hexdigits>` is a SHA-1 hash value of `fig1.png`.
This is the id of the figure.

Add a figure node
-----------------
To add a figure node into node_list,
you must specify

- `figure_directory` into where the figures are copied
- `json_file` which contains `node_list`

In this sample, you should use `./figure` as `figure_directory`,
and `./data_information.json` as `json_file`.
Then the register command becomes as follows:

    $ mkdir figures
    $ ../bin/register_figure ./figures ./data_information.json datadir/project1/run01/fig1.png -g datadir/project1/run01/fig1.gp

