#!/usr/bin/python
# coding=utf-8
import argparse
import os.path
import sys
import traceback

sys.path = ([sys.path[0]]
            + [os.path.join(os.path.dirname(__file__), "../lib")]
            + sys.path[1:])
import dataprocessor as dp
sys.path = [sys.path[0]] + sys.path[2:]


def main():
    parser = argparse.ArgumentParser(description="""
                command line interface for DataProcessor pipeline""")
    parser.add_argument('json_filename')
    args = parser.parse_args()

    json_fn = dp.utility.check_file(args.json_filename)
    with open(json_fn, 'r') as f:
        dp.execute_from_json_str(f.read())


if __name__ == "__main__":
    try:
        main()
    except dp.InvalidJSONError as e:
        print("ERROR occurs in pipe '%s'" % e.name)
        print("Message: %s" % e.msg)
        print("Please review your JSON file.")
        sys.exit(1)
    except (dp.DataProcessorError, dp.__init__.DataProcessorError) as e:
        print("ERROR in command-line arguments.")
        print("Message: %s" % e.msg)
        print(traceback.format_exc())
        sys.exit(1)
